<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auto OTP Reader — Example</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; display:flex;flex-direction:column;align-items:center; padding:40px; }
    .otp { display:flex; gap:8px; margin:20px 0; }
    .otp input {
      width:44px; height:56px; font-size:28px; text-align:center;
      border:1px solid #ccc; border-radius:8px;
    }
    button { padding:10px 16px; border-radius:8px; cursor:pointer; }
    .info { color:#555; font-size:14px; max-width:560px; text-align:center; }
  </style>
</head>
<body>
  <h2>Enter verification code</h2>

  <div class="otp" id="otp-container">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d0" autocomplete="one-time-code">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d1" autocomplete="one-time-code">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d2" autocomplete="one-time-code">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d3" autocomplete="one-time-code">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d4" autocomplete="one-time-code">
    <input inputmode="numeric" pattern="\d*" maxlength="1" class="digit" id="d5" autocomplete="one-time-code">
  </div>

  <button id="submitBtn">Submit</button>

  <p class="info" id="status">Waiting for code... (or type/paste it)</p>

<script>
(function(){
  const inputs = Array.from(document.querySelectorAll('.digit'));
  const status = document.getElementById('status');
  const submitBtn = document.getElementById('submitBtn');

  // helpers
  function getCode() { return inputs.map(i => i.value || '').join(''); }
  function setCode(code) {
    if (!code) return;
    code = (''+code).replace(/\D/g,'').slice(0,6).padEnd(6,'');
    inputs.forEach((input, i) => input.value = code[i] === ' ' ? '' : code[i]);
  }
  function submitOTP() {
    const code = getCode();
    if (code.length !== 6 || /\D/.test(code)) {
      status.textContent = 'Please enter a 6-digit code.';
      return;
    }
    status.textContent = 'Submitting...';
    // Replace this fetch URL with your verification endpoint
    fetch('/verify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ otp: code })
    }).then(r => {
      if (r.ok) return r.json();
      throw new Error('Network response not ok');
    }).then(data => {
      status.textContent = 'Verified (server response): ' + JSON.stringify(data);
    }).catch(err => {
      status.textContent = 'Submit failed: ' + err.message;
    });
  }

  // Input behavior: move focus, handle paste
  inputs.forEach((input, idx) => {
    input.addEventListener('input', e => {
      const v = e.target.value.replace(/\D/g,'');
      e.target.value = v.slice(0,1);
      if (v && idx < inputs.length - 1) inputs[idx+1].focus();
      if (getCode().length === 6) submitOTP();
    });
    input.addEventListener('keydown', e => {
      if (e.key === 'Backspace' && !e.target.value && idx > 0) {
        inputs[idx-1].focus();
      } else if (e.key === 'ArrowLeft' && idx > 0) {
        inputs[idx-1].focus();
      } else if (e.key === 'ArrowRight' && idx < inputs.length - 1) {
        inputs[idx+1].focus();
      }
    });
    // allow paste across inputs
    input.addEventListener('paste', e => {
      e.preventDefault();
      const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
      setCode(paste);
      if (paste.length === 6) submitOTP();
    });
  });

  submitBtn.addEventListener('click', submitOTP);

  // Try Web OTP API (Chrome on Android)
  async function tryWebOTP() {
    if (!('credentials' in navigator)) {
      status.textContent = 'Web OTP not supported in this browser — type the code manually.';
      return;
    }
    try {
      // The OTP API resolves with an object { code: '123456' } in supportive browsers
      status.textContent = 'Listening for SMS (Web OTP)...';
      const ac = new AbortController();
      // Stop listening after 60s
      setTimeout(() => ac.abort(), 60000);

      const content = await navigator.credentials.get({
        otp: { transport: ['sms'] },
        signal: ac.signal
      });
      // content.code will be the OTP string
      if (content && content.code) {
        setCode(content.code);
        status.textContent = 'Code received from SMS.';
        submitOTP();
      } else {
        status.textContent = 'No OTP received via Web OTP.';
      }
    } catch (err) {
      // user dismissed, not supported, or permission denied
      status.textContent = 'Web OTP failed or was blocked: ' + (err && err.message ? err.message : 'unknown');
    }
  }

  // Focus first input on load
  inputs[0].focus();
  // Attempt to use Web OTP
  tryWebOTP();

})();
</script>
</body>
</html>
